## 关于c++的代码优化
- 编译优化
	如果开启优化选项，ollvm的三种代码混淆方法就会失效。Instructions Substitution(-mllvm -sub);Bogus Control Flow(-mllvm -bcf);Control Flow Flattening( -mllvm -fla)。
	不被优化的方法：
  - 使用全局变量。
  - 使用参数。
  - 调用类的属性或方法
  - 使用复杂while和if的嵌套。参考obf.cpp.
     可以使用等于，大于，小于来构建多种不同的代码结构。
- 链接优化
  -	类的没有调用的非虚函数会,会被优化掉。
  - 类的没有调用的虚函数，会被保留。
  - 类的有调用的简单非虚函数，会被内联优化掉
  - 类的简单非虚函数，被其它类调用，会被保留。
  - 如果类没有被引用，则会被优化掉。如果被引用，确保引用的位置不被优化掉。
		总结：可以把代码放在虚函数中，并且保持这个类被使用到。

## 代码链接的位置
- ios
  按照Compile Source定义的顺序最后出现在二进制文件的位置。Compile Sourcec对应project.pbxproj里的PBXSourcesBuildPhase。在混淆的时候把这里面的内容做乱序处理。

## 混淆方法
- 改变编译顺序(xcode中会引想链接到可执行文件的位置)
- 改变函数顺序(调整源文件中的函数位置，暂未实现，涉及符号的先后顺序，直接换会编译通不过。)
  - 先进行简单的改变：
    - 检查是否有c函数，如果有，生成一个声明放在最前面。可能涉及到typedef这样的类型重定义。
    - 检查是否有变量声明，如果有，移到最前面。
    - 交换函数位置。生成一个数组，大小为要交换函数的数量，值为函数在函数列表的索引。
       再对这个数组进行洗牌排列，按这个数组的值，对源函数进行交换。
- 改变函数内容
  - 调用类的方法和属性
  - 插入复杂代码段
  - 调用全局变量